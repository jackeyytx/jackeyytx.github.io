<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>iOS的后台程序 – Toki_Han</title> <meta name="description" content="Learn + Share = Progress"> <meta name="keywords" content="iOS基础"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://LSnail.github.io/assets/img/logo.png"> <meta name="twitter:title" content="iOS的后台程序"> <meta name="twitter:description" content="一、IOS的“伪后台”程序"> <meta name="twitter:site" content="@username"> <meta name="twitter:creator" content="@username"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="iOS的后台程序"> <meta property="og:description" content="一、IOS的“伪后台”程序"> <meta property="og:url" content="https://LSnail.github.io/ios-fake-background-task/"> <meta property="og:site_name" content="Toki_Han"> <meta property="og:image" content="https://LSnail.github.io/assets/img/logo.png"> <link rel="canonical" href="https://LSnail.github.io/ios-fake-background-task/"> <link href="https://LSnail.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Toki_Han Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://LSnail.github.io/assets/css/main.css"> <!-- JS --> <script src="https://LSnail.github.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://LSnail.github.io/assets/img/favicons/iphone-5c-blue.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://LSnail.github.io/assets/img/favicons/iphone-5c-blue.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://LSnail.github.io/assets/img/favicons/iphone-5c-blue.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://LSnail.github.io/assets/img/favicons/iphone-5c-blue.png"> <link rel="shortcut icon" type="image/png" href="https://LSnail.github.io/favicon.png"> <link rel="shortcut icon" href="https://LSnail.github.io/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(https://LSnail.github.io/assets/img/placeholder-big.jpg); }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://LSnail.github.io/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://LSnail.github.io/assets/img/logo.png" alt="Toki_Han photo" class="author-photo"> <h4>Toki_Han</h4> <p>Learn + Share = Progress</p> </li> <li><a href="https://LSnail.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://twitter.com/username" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://facebook.com/username" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a> </li> <li> <a href="http://instagram.com/username" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-instagram"></i> Instagram</a> </li> <li> <a href="http://github.com/LSnail" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> <li> <a href="http://steamcommunity.com/id/username" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-steam-square"></i> Steam</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://LSnail.github.io/posts/">All Posts</a></li> <li><a href="https://LSnail.github.io/tags/">All Tags</a></li> </ul> </li> <li><a href="https://LSnail.github.io/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>iOS的后台程序</h1> <h4>29 Sep 2015</h4> <a class="btn zoombtn" href="https://LSnail.github.io/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <h3 id="ios">一、IOS的“伪后台”程序</h3> <p>首先，先了解一下iOS 中所谓的「后台进程」到底是怎么回事吧？</p> <p>Let me be as clear as I can be: the iOS multitasking bar does not contain “a list of all running apps”. It contains “a list of recently used apps”. The user never has to manage background tasks on iOS.</p> <p>首先我们得搞清楚的是，iOS 中所谓的「后台驻留」并不是指「执行中的程序」，而是「最近使用过的程序」，也可以瞧瞧Apple 的知识库文章怎么写的：</p> <p>按两下主画面按钮后，显示的是「最近用过的应用程序」，所以别把它想成Mac OS X 中的Command + Tab 键所显示的切换程序列；你可以试试看将iPhone 关机再开机，然后按两下Home 键，应该会发现先前那些程式还是出现在那里，因为它其实是你最近使用过的程序使用记录，或像是浏览器中的浏览记录)。</p> <div class="highlighter-rouge"><pre class="highlight"><code>如果你一个一个去清除 "后台驻留" 的程序，就像是一笔一笔删除浏览记录中的项目一样，是没有太大意义的(除非你不想让其他人看到你曾经用过什么程式，或者想杀时间、太无聊了)，也不会对电力或记忆体有什么帮助。
</code></pre></div> <p>iOS 的多任务处理其实是很聪明的，系统会自动中止在背景执行的程序，在有需要时，也会将被中止的程式suspended（注:”中止的程式”不是指关闭程序，而是指由前台转向后台的程序，程序在后台并不真正运行，不要和关闭程序混淆了) 从内存中移除。因此，iOS 装置的使用者根本就不需要担心怎么管理这些执行中或不在执行中的程序，尽管放心用、轻松玩就是了！</p> <p>一般说来，所有程式进入背景后都还有<code class="highlighter-rouge">5秒</code>的执行缓冲时间，有些程序可以要求延长到<code class="highlighter-rouge">10分钟</code>(这些当然是由开发人员在设计与提交程式时决定和声明)；</p> <p>因此，在你按下Home 键后，本来的程式就会退到背景，如果它有额外的背景执行作业，超过10 分钟还是会被iOS 中止；所以，还是别担心了！</p> <p>但是，也有例外情况，某些特殊类型的程式是被容许在背景中持续执行的，像是会持续在背景播放音乐的程序、GPS 程序、VOIP 程序、Newsstand 以及周边配件附属的程序，不过只要这些程序不再执行动作，就会变成中止的程式，像是音乐拨完了、杂志下载完了… 因此，使用者其实也没必要太过留意这些程序。</p> <p>you do not have to manage background tasks on iOS. The 　　system handles almost every case for you and well written audio, GPS, VOIP, Newsstand and accessory apps will handle the rest.</p> <h3 id="ios-1">二、IOS的“多任务”发展史</h3> <p>自从出现了操作系统以来，就没有过所谓真正的“多任务”。所谓多任务，无非是CPU速度够快而足以支撑极短时间内在多个进程内动作罢了。而所谓的“单任务”，无非是只能让当前任务独享资源罢了。</p> <p>简单来说，IOS 4 APP类型可以分为三种：</p> <ol> <li>
<code class="highlighter-rouge">保存现场</code> 即：按下Home键10秒内直接杀死进程，并释放内存。一般说来，所有程序进入背景后都还有5 秒的执行缓冲时间，有些程序可以要求延长到10 分钟(这些当然是由开发人员在设计与提交程式时决定和声明)；因此，在你按下Home 键后，本来的程式就会退到背景，如果它有额外的背景执行作业，超过10 分钟还是会被iOS 中止。</li> <li>
<code class="highlighter-rouge">iOS支持的“多任务”</code> 即：按下Home键转入多任务状态，保留在内存中，但只能系统允许的动作：比如GPS，比如VoIP，比如Streaming Music等等。</li> <li>
<code class="highlighter-rouge">真正的桌面级别的多任务</code> 即：只有Safari/Mail才是真正的多任务，苹果嫡系大都都不是。这个级别的app在后台是没有任何限制动作。（对于无限制动作的程序，一是会在用户无察觉的情况下耗光电力，二是会有安全上面的问题)。</li> </ol> <p>注意：对于上述三种级别，后两种会占用内存的APP，也会在任意时间从内存中被砍掉，取决于你是否动用了其它app而导致内存不足。真正不会被砍掉的后台，只有苹果那个通知系统。</p> <p>其实可以回顾一下iOS是怎么一步步引入现在这个机制的：</p> <ol> <li>刚出生，什么都没有，单纯的单任务。</li> <li>iPhone OS 3.0，引入通知架构。几乎当年全部机型可用；Android晚了一年，2.2才有此功能，到这个时候相信才有90%上下机器用上。</li> <li>iOS 4.0+，引入有限制的后台多任务。</li> </ol> <p>搞这么复杂干嘛？直接像Android一出生那样所有app一个小虚拟机，无任何限制动作，让根本没有内存管理经验和资源消耗概念的全世界最大民工群Java程序员们写的app任意地跑着吧！</p> <p>答案只有两个：电力，安全。安全不说，如何在保持多任务优势的同时，避免消耗过多电力，苹果花了很多心思；而不是像webOS/Android一样，简单粗暴桌面级的多任务。iPhone 4甚至在硬件上面也下了苦功，利用3D层叠技术组装A4芯片，内部元件高度集成，并把天线移至体表，增加内部电池空间。</p> <p>其实至iPhone OS 3，已经足够应付大部分应用了。用户根本无从知道app的实际运行状态，保存现场让app看起来不像是刚打开一样，通知系统又可以在后台默默推送消息。事实上，当前95% iOS APP依旧只有“保存现场 + 通知系统”这样的组合，比如很多twitter客户端，大部分人根本不会注意到它不是真正意义上的“多任务”。很震撼的事实，但确实95%的应用场景根本不需要所谓真正的“多任务”。</p> <p>但是时代在变。真正需要多任务的东西出现了：电台要stream，IM要stream，GPS要stream，多任务必须提上日程。iOS 4加进了，WP7刚刚加进了，Android/webOS打一出生就有。从本质来说，iOS/WP7/Android/webOS跑在内存中的后台程序，唯一的区别就是，iOS/WP7限制了它可以做的事(这就是为什么它们一出生都没有多任务的原因，这个架构很复杂，不是几百行中文字可以说明白的)，而Android/webOS没有；从技术上面来说，iOS/WP7/webOS三者架构相当，Android独立门户。 于是很可笑，有无限制，成了真“多任务”和伪“多任务”的区别；而后者架构更复杂，</p> <p>可以套用一句“吃力不讨好”。</p> <p>为什么要做吃力不讨好的事？答案依旧在上面，电力和安全。当然你可以说iPhone电力也没好到哪里去，安全也就一般般嘛。暂且抛掉这两样不谈，实际看看iOS有限制后台app，和Android完全无限制后台app有什么不同：</p> <p>相信我，最终你会发现iOS上最令人诟病的app，是那些不支持标准协议的软件平台商们，比如腾讯。因为iOS后台允许的动作，已经覆盖了全部大大小小的通信开源协议。</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://LSnail.github.io/tags/#iOS%E5%9F%BA%E7%A1%80" title="Pages tagged iOS基础" class="tag"><span class="term">iOS基础</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://LSnail.github.io/ios-fake-background-task/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Like</span> </a> <a href="https://twitter.com/intent/tweet?text=https://LSnail.github.io/ios-fake-background-task/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://LSnail.github.io/ios-fake-background-task/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> </header> <!-- JS --> <script src="https://LSnail.github.io/assets/js/jquery-1.12.0.min.js"></script> <script src="https://LSnail.github.io/assets/js/jquery.dlmenu.min.js"></script> <script src="https://LSnail.github.io/assets/js/jquery.goup.min.js"></script> <script src="https://LSnail.github.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="https://LSnail.github.io/assets/js/jquery.fitvid.min.js"></script> <script src="https://LSnail.github.io/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'taylantatli'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
